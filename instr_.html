<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Document</title>
</head>
<body>
	<script src="style.js" async></script>
	<style>
		:root{user-select:none;-webkit-user-select:none;touch-action:manipulation;}
		html,body{height:100%;margin:0;position:relative;overflow:hidden;}
		#c{display:block;margin:0 auto;width:100%;max-height:auto;touch-action:none;}
	</style>
	<canvas id="c"></canvas>
	<script>
		'use strict';
		let img=new Image();
		const ctx=c.getContext('2d'),
			ccfg={
				grid:[5,3],
				gflag:new Array(15).fill(0),
				gsize:88,
				c:true
			},
			csset=()=>{
				Object.assign(c.style,{maxWidth:ccfg.gsize*ccfg.grid[0]+'px',maxHeight:ccfg.gsize*ccfg.grid[1]+'px',marginTop:`min(${ccfg.gsize/2}px,${50/ccfg.grid[0]}%)`});
				c.width=Math.min(innerWidth,ccfg.gsize*ccfg.grid[0])*devicePixelRatio;ccfg.size=c.width/ccfg.grid[0];c.height=ccfg.size*ccfg.grid[1];
			},
			fire=e=>{
				e.preventDefault();
				const bcr=c.getBoundingClientRect();
				(e.changedTouches?[...e.changedTouches]:[e]).forEach(x=>{
					const p=[(x.clientX-bcr.x)/bcr.width,(x.clientY-bcr.y)/bcr.height],
						i=Math.floor(p[0]*ccfg.grid[0])+Math.floor(p[1]*ccfg.grid[1])*ccfg.grid[0],
						trg=!ccfg.gflag.some(x=>x);
						ccfg.gflag[i]=24;
					if(trg)draw();
					// ctx.fillStyle='#'+Math.floor(Math.random()*4096).toString('16').padStart(3,'0');
					// ctx.fillRect(p[0]*c.width,p[1]*c.height,4,4);
				});
			},
			draw=()=>{
				ctx.clearRect(0,0,c.width,c.height);
				const r=12*devicePixelRatio,a=ccfg.size*.784,ai=(ccfg.size-a)/2,ar=a-r-r,
					rs=(x=0,y=0,ct=1)=>{
						const arct=ar*ct,rct=r*ct,sct=+(Math.sign(ct)<0);
						return new Path2D(`M${x+ccfg.size/2} ${y+ccfg.size/2}m${-arct/2-rct} ${-ar/2}
							v${ ar}a${rct} ${r} 0 0 ${sct} ${ rct} ${ r}
							h${ arct}a${rct} ${r} 0 0 ${sct} ${ rct} ${-r}
							v${-ar}a${rct} ${r} 0 0 ${sct} ${-rct} ${-r}
							h${-arct}a${rct} ${r} 0 0 ${sct} ${-rct} ${ r}
						`);
					};
				ctx.fillStyle='#3338';
				ccfg.gflag=ccfg.gflag.map((x,i)=>{
					i=[i%ccfg.grid[0],Math.floor(i/ccfg.grid[0])];
					const p=i.map(y=>y*ccfg.size),ct=Math.cos(x/12*Math.PI);
					ctx.fill(rs(...p,ct));
					ctx.drawImage(img,
						ccfg.c&&i[0]==i[1]*2?0:128*(2-i[0]%2),0,128,128,
						(i[0]+.5)*ccfg.size-a/2*ct,p[1]+ai,a*ct,a);
					return Math.max(x-1,0);
				});
				if(ccfg.gflag.some(x=>x))requestAnimationFrame(draw);
			};
		['touchstart','mousedown'].forEach(x=>c.addEventListener(x,fire));
		onresize=()=>{csset();draw();};

		// document.addEventListener('keydown',e=>{
		// 	{preventDefault:()=>{}}
		// });


		csset();draw();
		img.onload=draw;img.src='img/instr.svg'
	</script>
</body>
</html>