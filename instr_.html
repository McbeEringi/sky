<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Document</title>
</head>
<body>
	<script src="style.js" async></script>
	<style>
		:root{user-select:none;-webkit-user-select:none;touch-action:manipulation;}
		html,body{height:100%;margin:0;position:relative;overflow:hidden;}
		#c{display:block;margin:0 auto;width:100%;max-height:auto;touch-action:none;}
	</style>
	<canvas id="c"></canvas>
	<script>
		'use strict';
		let dflag=[],ccfg={},img=new Image();
		const ctx=c.getContext('2d'),
			csset=(x=[5,3],a=80)=>{
				ccfg.grid=x;ccfg.size=a*devicePixelRatio;ccfg.c=x[0]==5&&x[1]==3;
				Object.assign(c.style,{maxWidth:a*x[0]+'px',maxHeight:a*x[1]+'px',marginTop:`min(${a/2}px,${50/x[0]}%)`});
				c.width=x[0]*ccfg.size;c.height=x[1]*ccfg.size;
			},
			fire=e=>{
				e.preventDefault();
				const bcr=c.getBoundingClientRect();
				(e.changedTouches?[...e.changedTouches]:[e]).forEach(x=>{
					const p=[(x.clientX-bcr.x)/bcr.width,(x.clientY-bcr.y)/bcr.height];
					ctx.fillStyle='#'+Math.floor(Math.random()*4096).toString('16').padStart(3,'0');
					ctx.fillRect(p[0]*c.width,p[1]*c.height,4,4);
				});
			},
			draw=()=>{
				ctx.clearRect(0,0,c.width,c.height);
				const r=12*devicePixelRatio,a=ccfg.size*.784,ai=ccfg.size*.108,ar=a-r-r,
					rs=(x=0,y=0,ct=1)=>{
						const arct=ar*ct,rct=r*ct;
						return new Path2D(`M${x+ccfg.size/2} ${y+ccfg.size/2}m${-arct/2-rct} ${-ar/2}
							v${ ar}a${rct} ${r} 0 0 0 ${ rct} ${ r}
							h${ arct}a${rct} ${r} 0 0 0 ${ rct} ${-r}
							v${-ar}a${rct} ${r} 0 0 0 ${-rct} ${-r}
							h${-arct}a${rct} ${r} 0 0 0 ${-rct} ${ r}
						`);
					};
				ctx.fillStyle='#3338';
				for(let j=0;j<ccfg.grid[1];j++)
					for(let i=0;i<ccfg.grid[0];i++){
						ctx.fill(rs(i*ccfg.size,j*ccfg.size,1));
						ctx.drawImage(img,ccfg.c&&i==j*2?0:128*(2-i%2),0,128,128,i*ccfg.size+ai,j*ccfg.size+ai,a,a);
					}
			};
		['touchstart','mousedown'].forEach(x=>c.addEventListener(x,fire));

		// document.addEventListener('keydown',e=>{
		// 	{preventDefault:()=>{}}
		// });


		csset();draw();
		img.onload=draw;img.src='img/instr.svg'
	</script>
</body>
</html>